openapi: 3.0.0
info:
  title: Markdown Analyzer API
  description: API for scanning and analyzing markdown files.
  version: 1.0.0
servers:
  - url: /
    description: Current server
paths:
  /scan_folder:
    post:
      summary: Scan a folder for .md files
      description: Returns a list of all markdown files found in a given directory.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                folder_path:
                  type: string
                  description: Absolute path inside the container to scan.
              example:
                folder_path: "/scan_data/mariadb-cloud"
      responses:
        '200':
          description: A list of found files.
          content:
            application/json:
              schema:
                type: object
                properties:
                  files:
                    type: array
                    items:
                      type: string
                  base_path:
                    type: string
              example:
                files: ["README.md", "topics/file.md"]
                base_path: "/scan_data/mariadb-cloud"
        '400':
          description: Bad request (e.g., no folder_path).
        '403':
          description: Path is not allowed (outside /scan_data).
        '404':
          description: Path not found.

  /analyze_files:
    post:
      summary: Analyze a list of files
      description: Runs the selected analysis modules on a list of files.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                files:
                  type: array
                  items:
                    type: string
                  example: ["README.md", "topics/file.md"]
                base_path:
                  type: string
                  example: "/scan_data/mariadb-cloud"
                options:
                  type: object
                  properties:
                    check_broken_links:
                      type: boolean
                    check_specific_url:
                      type: boolean
                    specific_url:
                      type: string
                    check_untagged_blocks:
                      type: boolean
                    check_find_text:
                      type: boolean
                    text_to_find:
                      type: string
              example:
                files: ["README.md"]
                base_path: "/scan_data"
                options:
                  check_untagged_blocks: true
                  check_find_text: true
                  text_to_find: "MariaDB"
      responses:
        '200':
          description: Analysis results.
          content:
            application/json:
              schema:
                type: object
                properties:
                  results:
                    type: object
                    additionalProperties:
                      $ref: '#/components/schemas/FileAnalysisResult'
        '400':
          description: Bad request (e.g., missing files list).

components:
  schemas:
    FileAnalysisResult:
      type: object
      properties:
        title:
          type: string
        broken_links:
          type: array
          items:
            type: object
            properties:
              link:
                type: string
              status:
                type: string
              text:
                type: string
        specific_url_links:
          type: array
          items:
            type: object
            properties:
              link:
                type: string
              text:
                type: string
        untagged_blocks:
          type: array
          items:
            type: integer
        found_text:
          type: array
          items:
            type: object
            properties:
              line_num:
                type: integer
              line_text:
                type: string

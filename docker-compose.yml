services:
  # Service 1: The API Gateway (The "Manager")
  api-gateway:
    build:
      context: .
      dockerfile: Dockerfile.base # <-- THIS IS THE FIX
    ports:
      - "5000:5000"
    volumes:
      - .:/app
      # This service WRITES to the shared disk
      - scan-cache:/tmp/scans
    command: python api_gateway.py
    depends_on:
      - content-scanner
      - http-auditor

  # Service 2: The "Fast" Content Scanner
  content-scanner:
    build:
      context: .
      dockerfile: Dockerfile.base
    volumes:
      - .:/app
      - scan-cache:/tmp/scans
    expose:
      - "5001"
    command: python content_scanner_service.py

  # Service 3: The "Slow" HTTP Auditor
  http-auditor:
    build:
      context: .
      dockerfile: Dockerfile.base
    volumes:
      - .:/app
      - scan-cache:/tmp/scans
    expose:
      - "5002"
    command: python http_auditor_service.py

# This creates the one shared disk
volumes:
  scan-cache:

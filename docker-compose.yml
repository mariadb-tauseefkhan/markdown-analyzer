services:
  # Service 1: The API Gateway (The "Manager")
  api-gateway:
    build:
      context: .
      dockerfile: Dockerfile.gateway
    ports:
      - "5000:5000"
    volumes:
      - .:/app
    # NOTE: No 'scan-cache' volume
    command: python api_gateway.py
    depends_on:
      - content-scanner
      - http-auditor

  # Service 2: The "Fast" Content Scanner
  content-scanner:
    build:
      context: .
      dockerfile: Dockerfile.base
    volumes:
      - .:/app
    # NOTE: No 'scan-cache' volume
    expose:
      - "5001"
    command: python content_scanner_service.py

  # Service 3: The "Slow" HTTP Auditor
  http-auditor:
    build:
      context: .
      dockerfile: Dockerfile.base
    volumes:
      - .:/app
    # NOTE: No 'scan-cache' volume
    expose:
      - "5002"
    command: python http_auditor_service.py
